<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>比赛动画</title>
    <!-- 引入您已有的样式文件 -->
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* 添加一些基础样式确保菜单正常显示 */
        .ant-menu {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }
        .ant-menu-item {
            padding: 0 15px;
            flex-shrink: 0;
        }
        .ant-menu-item-selected {
            color: #1890ff;
            border-bottom: 2px solid #1890ff;
        }
    </style>
</head>
<body>
<div class="live-animation">
    <!-- 动画容器 -->
    <div class="live-widget" id="live-widget"></div>

    <!-- 菜单容器 -->
    <div class="menu-container" id="menu-container" style="display: none;">
        <div class="ant-menu" id="sport-menu">
            <!-- 菜单项将通过JS动态生成 -->
        </div>
        <!-- 数据展示容器 -->
        <div class="sir-widget" id="sir-widget"></div>
    </div>
</div>

<script>
    // 从URL获取参数
    function getUrlParams() {
        const params = {};
        const queryString = window.location.search.substring(1);
        const pairs = queryString.split('&');

        pairs.forEach(pair => {
            const [key, value] = pair.split('=');
            if (key) {
                params[key] = decodeURIComponent(value || '');
            }
        });

        return params;
    }

    // 初始化SIR脚本
    function initSir() {
        if (document.getElementById('SIR-IM-Sport')) {
            return;
        }

        (function(a,b,c,d,e,f,g,h,i){
            a[e]||(i=a[e]=function(){
                (a[e].q=a[e].q||[]).push(arguments)
            },i.l=1*new Date,i.o=f,
            g=b.createElement(c),h=b.getElementsByTagName(c)[0],
            g.async=1,g.src=d,g.setAttribute("n",e),
            h.parentNode.insertBefore(g,h)
        })(window,document,"script",
           "https://ws-cdn001.akamaized.net/b8b1e37591e951674647e626f875a954/widgetloader",
           "SIR", {
            theme: false, // 使用自定义主题
            language: "zh"
        });
    }

    // 显示小部件
    function showWidget(matchId, widgetType) {
        const container = document.getElementById('sir-widget');
        container.className = 'sir-widget-' + matchId;
        container.innerHTML = '';

        if (window.SIR && widgetType) {
            window.SIR("addWidget", ".sir-widget-" + matchId, widgetType, { matchId });
        }
    }

    // 显示直播动画
    function showLiveGame(matchId, sport) {
        const container = document.getElementById('live-widget');
        container.className = 'live-widget-' + matchId;
        container.innerHTML = '';

        if (window.SIR) {
            if (sport != 1 && sport != 2) {
                // 网球、乒乓球 加强型动画
                window.SIR("addWidget", ".live-widget-" + matchId, "match.lmtPlus", {
                    layout: "topdown",
                    matchId
                });
            } else {
                // 足球和篮球基础动画
                window.SIR("addWidget", ".live-widget-" + matchId, "match.lmtEssential", { matchId });
            }
        }
    }

    // 创建菜单
    function createMenu(sport) {
        const menuContainer = document.getElementById('menu-container');
        const menu = document.getElementById('sport-menu');

        // 只有足球(1)和篮球(2)显示菜单
        if (sport == 1 || sport == 2) {
            menuContainer.style.display = 'block';

            const menuItems = [
                { key: 'match.statistics', text: '分析' },
                { key: 'match.verticalTimeline', text: '总览' },
                { key: 'season.liveTable', text: '列表' },
                { key: 'match.headToHead', text: '对决' }
            ];

            // 足球和篮球有不同的统计菜单项
            if (sport == 1) {
                menuItems.push(
                    { key: 'match.generalStatistics', text: '统计' },
                    { key: 'match.lineups', text: '阵容' },
                    { key: 'season.toplists', text: '排行' }
                );
            } else if (sport == 2) {
                menuItems.push(
                    { key: 'match.Basketball.matchups', text: '统计' }
                );
            }

            // 生成菜单HTML
            menu.innerHTML = menuItems.map(item => `
                <div class="ant-menu-item" data-key="${item.key}">${item.text}</div>
            `).join('');

            // 添加点击事件
            const items = menu.getElementsByClassName('ant-menu-item');
            Array.from(items).forEach(item => {
                item.addEventListener('click', function() {
                    // 移除所有选中状态
                    Array.from(items).forEach(i => {
                        i.classList.remove('ant-menu-item-selected');
                    });
                    // 添加当前选中状态
                    this.classList.add('ant-menu-item-selected');

                    // 显示对应的小部件
                    const matchId = getUrlParams().matchId;
                    showWidget(matchId, this.dataset.key);
                });
            });

            // 默认选中第一个菜单项
            if (items.length > 0) {
                items[0].classList.add('ant-menu-item-selected');
            }
        }
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        const params = getUrlParams();
        const matchId = params.matchId;
        const sport = parseInt(params.sport) || 1;
        const openMenu = params.openMenu !== 'false';
        const openLive = params.openLive !== 'false';

        // 初始化SIR
        initSir();

        // 显示直播动画
        if (openLive) {
            showLiveGame(matchId, sport);
        }

        // 创建菜单
        if (openMenu) {
            createMenu(sport);

            // 默认显示第一个小部件
            const defaultWidget = sport == 1 || sport == 2 ? 'match.statistics' : '';
            if (defaultWidget) {
                showWidget(matchId, defaultWidget);
            }
        }
    });
</script>
</body>
</html>