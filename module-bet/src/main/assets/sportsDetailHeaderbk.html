<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Plugins</title>
    <link rel="stylesheet" href="./theme.css">
    <link rel="stylesheet" href="./style.css">
</head>
<body>
<div id="live-animation" class="live-animation"></div>

<script>
    // Function to initialize the game plugin with parameters
    function initGamePlugin(params) {
        const defaultParams = {
            matchId: 'default',
            sport: 1, // 1: football, 2: basketball, others: tennis/pingpong
            openMenu: true,
            openLive: true,
            index: 0,
            closeLive: () => console.log('Close live clicked')
        };
        const config = { ...defaultParams, ...params };
        let currentMenu = config.openMenu ? 'match.statistics' : '';

        // Initialize SIR script
        function initSir() {
            if (document.getElementById('SIR-IM-Sport')) return;
            (function(a, b, c, d, e, f, g, h, i) {
                a[e] || (i = a[e] = function() {
                    (a[e].q = a[e].q || []).push(arguments)
                }, i.l = 1 * new Date, i.o = f,
                g = b.createElement(c), h = b.getElementsByTagName(c)[0], g.async = 1, g.src = d, g.setAttribute("n", e), h.parentNode.insertBefore(g, h))
            })(window, document, "script", "https://ws-cdn001.akamaized.net/b8b1e37591e951674647e626f875a954/widgetloader", "SIR", {
                theme: false,
                language: "zh"
            });
        }

        // Show live game widget
        function showLiveGame() {
            if (config.sport !== 1 && config.sport !== 2) {
                window.SIR("addWidget", `.live-widget-${config.matchId}`, "match.lmtPlus", { layout: "topdown", matchId: config.matchId });
            } else {
                window.SIR("addWidget", `.live-widget-${config.matchId}`, "match.lmtEssential", { matchId: config.matchId });
            }
        }

        // Show widget based on current menu
        function showWidget() {
            if (currentMenu) {
                window.SIR("addWidget", `.sir-widget-${config.matchId}`, currentMenu, { matchId: config.matchId });
            }
        }

        // Render the UI
        function render() {
            const container = document.getElementById('live-animation');
            container.innerHTML = `
                <div class="closeLive" onclick="closeLive()">X</div>
                <div class="live-widget-${config.matchId}"></div>
                ${config.sport === 1 || config.sport === 2 ? `
                    <div class="menu-container">
                        <div class="menu-item ${currentMenu === 'match.statistics' ? 'active' : ''}" data-key="match.statistics">分析</div>
                        <div class="menu-item ${currentMenu === 'match.verticalTimeline' ? 'active' : ''}" data-key="match.verticalTimeline">总览</div>
                        <div class="menu-item ${currentMenu === 'season.liveTable' ? 'active' : ''}" data-key="season.liveTable">列表</div>
                        <div class="menu-item ${currentMenu === 'match.headToHead' ? 'active' : ''}" data-key="match.headToHead">对决</div>
                        <div class="menu-item ${currentMenu === (config.sport === 1 ? 'match.generalStatistics' : 'match.Basketball.matchups') ? 'active' : ''}"
                            data-key="${config.sport === 1 ? 'match.generalStatistics' : 'match.Basketball.matchups'}">统计</div>
                        ${config.sport === 1 ? `
                            <div class="menu-item ${currentMenu === 'match.lineups' ? 'active' : ''}" data-key="match.lineups">阵容</div>
                            <div class="menu-item ${currentMenu === 'season.toplists' ? 'active' : ''}" data-key="season.toplists">排行</div>
                        ` : ''}
                    </div>
                    ${currentMenu ? `<div class="sir-widget-${config.matchId}"></div>` : ''}
                ` : ''}
            `;

            // Add event listeners for menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    currentMenu = item.dataset.key;
                    render();
                    showWidget();
                });
            });
        }

        // Close live function
        window.closeLive = () => config.closeLive(config.index);

        // Initialize
        initSir();
        if (config.openLive) showLiveGame();
        if (currentMenu) showWidget();
        render();
    }

    // Example usage: can be called from Android
    // initGamePlugin({ matchId: '12345', sport: 1, openMenu: true, openLive: true });
</script>
</body>
</html>